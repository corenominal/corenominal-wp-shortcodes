<?php
if ( ! defined( 'WPINC' ) ) { die('Direct access prohibited!'); }
/**
 * Github Project
 * Usage: [corenominal-github-project repo="foo"]
 */
function corenominal_shortcode_github_project( $atts, $content = null )
{
	$atts = shortcode_atts(
				array(
						'repo' => 'rocket-menu'
				), $atts
			);

	$github_icon = '<svg width="13px" height="12px" viewBox="0 0 13 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
					    <desc>GitHub Icon</desc>
					    <defs></defs>
					    <path d="M0.552370818,9.18043638 C0.718141493,9.51259397 0.939374474,9.80284672 1.21606976,10.0659846 C1.47859135,10.3285061 1.7971915,10.5361817 2.14290655,10.6883949 C2.48862159,10.8541656 2.84851035,10.9786476 3.19422539,11.088956 C3.5534979,11.1863232 3.9411178,11.2689004 4.37002631,11.3108052 C4.81249228,11.3656513 5.18593848,11.3933824 5.51809608,11.4075561 C5.84963742,11.4211136 6.20952618,11.4352873 6.61070353,11.4352873 C7.08090065,11.4352873 7.50980916,11.4211136 7.89681282,11.3933824 C8.28443272,11.379825 8.72689868,11.3243627 9.22482696,11.2276118 C9.72275523,11.1444183 10.1652212,11.0199362 10.5386674,10.867723 C10.9262873,10.7155098 11.286176,10.4942768 11.6318911,10.2040241 C11.9776061,9.91377133 12.2543014,9.58161373 12.4478033,9.18043638 C12.7657872,8.54385234 12.9180004,7.70020902 12.9180004,6.63533271 C12.9180004,5.40406949 12.5722853,4.38048179 11.8666815,3.56456963 C12.0053373,3.14983482 12.0743571,2.7067526 12.0743571,2.26428664 C12.0743571,1.66960746 11.949875,1.10265942 11.6731797,0.577 C11.1339628,0.577 10.6360346,0.673750914 10.2206835,0.881426443 C9.79177499,1.07492827 9.30802042,1.39291217 8.76818729,1.82182068 C8.09093089,1.65605 7.37115339,1.57285654 6.61070353,1.57285654 C5.78061766,1.57285654 4.97826295,1.65605 4.23137054,1.83537813 C3.67797997,1.40708587 3.19422539,1.08848572 2.76531688,0.881426443 C2.35058207,0.673750914 1.8526538,0.577 1.29926322,0.577 C1.03612539,1.10265942 0.911643321,1.66960746 0.911643321,2.26428664 C0.911643321,2.72092631 0.980663081,3.14983482 1.11931885,3.57812708 C0.41371505,4.39465549 0.068,5.41824319 0.068,6.63533271 C0.068,7.70020902 0.233770674,8.54385234 0.552370818,9.18043638 L0.552370818,9.18043638 Z M2.32285092,6.41409973 C2.68212342,5.98519122 3.16649424,5.76395824 3.77534713,5.76395824 C3.99658011,5.76395824 4.49450838,5.81942055 5.28268939,5.92972891 C5.64257814,5.98519122 6.0437555,6.01292238 6.48622146,6.01292238 C6.92868743,6.01292238 7.32986478,5.98519122 7.70331099,5.92972891 C8.49210825,5.81942055 8.99003652,5.76395824 9.1970958,5.76395824 C9.81950614,5.76395824 10.2897033,5.98519122 10.649592,6.41409973 C11.0094808,6.84300824 11.1888089,7.36866767 11.1888089,7.99107801 C11.1888089,8.44710142 11.1062317,8.83472133 10.9398448,9.16687892 C10.7740741,9.49842027 10.5663985,9.77511556 10.3174344,9.95505994 C10.0684703,10.1485618 9.75048638,10.300775 9.37704018,10.4252571 C9.00359397,10.5361817 8.64370522,10.6187589 8.29799017,10.64649 C7.95227512,10.6883949 7.56527147,10.7019523 7.13636296,10.7019523 L5.84963742,10.7019523 C5.42134516,10.7019523 5.03372526,10.6883949 4.68801021,10.64649 C4.34229516,10.6187589 3.98240641,10.5361817 3.6089602,10.4252571 C3.235514,10.300775 2.91753011,10.1485618 2.66856597,9.95505994 C2.41960183,9.77511556 2.21192631,9.49842027 2.04615563,9.16687892 C1.88038496,8.83472133 1.7971915,8.44710142 1.7971915,7.99107801 C1.7971915,7.36866767 1.97713587,6.84300824 2.32285092,6.41409973 L2.32285092,6.41409973 Z M3.45674698,9.20816753 C3.6089602,9.38811191 3.80246203,9.47068912 4.02431126,9.47068912 C4.23137054,9.47068912 4.42487237,9.38811191 4.57708559,9.20816753 C4.72929881,9.02822316 4.84022343,8.83472133 4.90924319,8.6270458 C4.97826295,8.40581282 5.0059941,8.19813729 5.0059941,7.99107801 C5.0059941,7.78340248 4.97826295,7.57572695 4.90924319,7.35449397 C4.84022343,7.14681844 4.72929881,6.95331661 4.57708559,6.77337223 C4.42487237,6.59404411 4.23137054,6.51085065 4.02431126,6.51085065 C3.80246203,6.51085065 3.6089602,6.59404411 3.45674698,6.77337223 C3.30453376,6.95331661 3.19422539,7.14681844 3.12520563,7.35449397 C3.05556963,7.57572695 3.02845472,7.78340248 3.02845472,7.99107801 C3.02845472,8.19813729 3.05556963,8.40581282 3.12520563,8.6270458 C3.19422539,8.83472133 3.30453376,9.02822316 3.45674698,9.20816753 L3.45674698,9.20816753 Z M8.39474109,9.20816753 C8.54695431,9.38811191 8.74045614,9.47068912 8.96230537,9.47068912 C9.16936465,9.47068912 9.36348272,9.38811191 9.5150797,9.20816753 C9.66729292,9.02822316 9.77821753,8.83472133 9.84723729,8.6270458 C9.91625705,8.40581282 9.94398821,8.19813729 9.94398821,7.99107801 C9.94398821,7.78340248 9.91625705,7.57572695 9.84723729,7.35449397 C9.77821753,7.14681844 9.66729292,6.95331661 9.5150797,6.77337223 C9.36348272,6.59404411 9.16936465,6.51085065 8.96230537,6.51085065 C8.74045614,6.51085065 8.54695431,6.59404411 8.39474109,6.77337223 C8.24314411,6.95331661 8.1322195,7.14681844 8.06319974,7.35449397 C7.99356373,7.57572695 7.96644882,7.78340248 7.96644882,7.99107801 C7.96644882,8.19813729 7.99356373,8.40581282 8.06319974,8.6270458 C8.1322195,8.83472133 8.24314411,9.02822316 8.39474109,9.20816753 L8.39474109,9.20816753 Z" id="Fill-183" stroke="none" fill="#212121" fill-rule="evenodd"></path>
					</svg>';

	$data = '<h3>' . $github_icon . ' GitHub</h3>';

	$data .= '<div class="btn-group-github">';

	/**
	 * Clone button
	 */
	$data .= '<a class="btn btn-github-clone" href="https://github.com/corenominal/' . $atts['repo'] . '">';
	$data .= 'Clone Repo';
	$data .= '</a>';

	 /**
 	 * Download button
 	 */
	$data .= '<a class="btn btn-github-download" href="https://github.com/corenominal/' . $atts['repo'] . '/archive/master.zip">';
 	$data .= 'Download Zip';
 	$data .= '</a>';

	$data .= '</div>';

	 /**
 	 * Latest Commits
 	 */
	include_once( ABSPATH . WPINC . '/feed.php' );
	$rss = 'https://github.com/corenominal/' . $atts['repo'] . '/commits/master.atom';
	$rss = fetch_feed( $rss );
	$maxitems = 0;

	if ( ! is_wp_error( $rss ) ):
    	$maxitems = $rss->get_item_quantity( 20 );
		$rss_items = $rss->get_items( 0, $maxitems );
	endif;

	if ( $maxitems > 0 ):
		$data .= '<h4 class="latest-guthub-commits">Latest Commits</h4>';
		$data .= '<ul class="latest-github-commits">';
		foreach ( $rss_items as $item ):
			$data .= '<li>';
			$data .= '<span>' . $item->get_date('Y-m-d') . '</span>';
			$data .= '<a href="' . $item->get_permalink() . '">';
			$data .= $item->get_title();
			$data .= '</a>';
			$data .= '</li>';
		endforeach;
		$data .= '</ul>';
	endif;

	return $data;

}
add_shortcode( 'corenominal-github-project', 'corenominal_shortcode_github_project' );
